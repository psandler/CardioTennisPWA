@using Microsoft.JSInterop

<!-- Help Modal -->
<div class="modal fade @(IsVisible ? "show d-block" : "")" tabindex="-1" style="@(IsVisible ? "background-color: rgba(0,0,0,0.5);" : "")">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Help & Instructions</h5>
                <button type="button" class="btn-close btn-close-white" @onclick="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-3" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == "howto" ? "active" : "")" 
                                type="button" 
                                @onclick='() => activeTab = "howto"'>
                            How to Use
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == "install" ? "active" : "")" 
                                type="button" 
                                @onclick='() => activeTab = "install"'>
                            Install App
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- How to Use Tab -->
                    <div class="tab-pane fade @(activeTab == "howto" ? "show active" : "")">
                        <h6 class="fw-bold mb-3">Quick Start Guide</h6>
                        
                        <div class="mb-4">
                            <h6 class="text-primary">1. Start a New Session</h6>
                            <ul class="mb-2">
                                <li>Click <strong>"New Session"</strong> on the home screen</li>
                                <li>Select number of <strong>courts</strong> (1-9)</li>
                                <li>Enter total number of <strong>players</strong></li>
                                <li>App calculates team sizes automatically</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <h6 class="text-primary">2. Assign Player Numbers</h6>
                            <ul class="mb-2">
                                <li>Have all players gather and count off: 1, 2, 3...</li>
                                <li>Each player remembers their number</li>
                                <li>Click <strong>"Done"</strong> when ready</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <h6 class="text-primary">3. Initial Teams (Optional)</h6>
                            <ul class="mb-2">
                                <li>App randomly assigns teams for first match</li>
                                <li>Review the team assignments</li>
                                <li><strong>Click "Remix Teams"</strong> if you want different teams</li>
                                <li>Teams will be balanced by player count</li>
                            </ul>
                            <div class="alert alert-info small mb-0">
                                <strong>Note:</strong> Remix is only available before the first match starts
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6 class="text-primary">4. Play Matches & Record Winners</h6>
                            <ul class="mb-2">
                                <li>Players compete on their assigned courts</li>
                                <li>After each match, tap <strong>"Team A Wins"</strong> or <strong>"Team B Wins"</strong></li>
                                <li>Winning players each earn 1 point</li>
                                <li>All courts must report before continuing</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <h6 class="text-primary">5. Continue or Reassign</h6>
                            <ul class="mb-2">
                                <li><strong>"Continue with Teams"</strong> - Same teams, rotate courts (winners up, losers down)</li>
                                <li><strong>"New Teams"</strong> - Creates new balanced teams based on current scores</li>
                            </ul>
                            <div class="alert alert-warning small mb-0">
                                <strong>Court Rotation:</strong> Winners move toward Court 1, losers move down ("up and down the ladder")
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6 class="text-primary">6. View Scores Anytime</h6>
                            <ul class="mb-2">
                                <li>Click <strong>"View Scores"</strong> button</li>
                                <li>See all players ranked by points</li>
                                <li>Close modal to continue playing</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <h6 class="text-primary">7. End Session</h6>
                            <ul class="mb-2">
                                <li>Click <strong>"End Session"</strong> when done</li>
                                <li>Confirm to see final scores</li>
                                <li>Winners will be ranked 1st, 2nd, 3rd</li>
                            </ul>
                        </div>

                        <div class="text-center mt-4">
                            <button class="btn btn-outline-primary" @onclick='() => activeTab = "install"'>
                                Learn How to Install This App &rarr;
                            </button>
                        </div>
                    </div>

                    <!-- Install App Tab -->
                    <div class="tab-pane fade @(activeTab == "install" ? "show active" : "")">
                        <h6 class="fw-bold mb-3">Install as a Progressive Web App (PWA)</h6>
                        
                        <p class="text-muted">Install this app on your device for offline access and a native app experience!</p>

                        <!-- Chrome / Edge (Desktop) -->
                        <div class="mb-4">
                            <h6 class="text-primary">Desktop (Chrome / Edge)</h6>
                            <ol>
                                <li>Look for the <strong>install icon</strong> (? or computer icon) in the address bar</li>
                                <li>Click it and select <strong>"Install"</strong></li>
                                <li>Or: Click the three-dot menu <strong>?</strong> ? "Install Cardio Tennis..."</li>
                                <li>App will open in its own window</li>
                            </ol>
                        </div>

                        <!-- Android Chrome -->
                        <div class="mb-4">
                            <h6 class="text-primary">Android (Chrome)</h6>
                            <ol>
                                <li>Tap the three-dot menu <strong>?</strong> (top-right)</li>
                                <li>Select <strong>"Add to Home screen"</strong> or <strong>"Install app"</strong></li>
                                <li>Tap <strong>"Add"</strong> or <strong>"Install"</strong></li>
                                <li>App icon will appear on your home screen</li>
                            </ol>
                        </div>

                        <!-- iOS Safari -->
                        <div class="mb-4">
                            <h6 class="text-primary">iPhone / iPad (Safari)</h6>
                            <ol>
                                <li>Tap the <strong>Share</strong> button (bottom center, square with arrow)</li>
                                <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
                                <li>Tap <strong>"Add"</strong> (top-right)</li>
                                <li>App icon will appear on your home screen</li>
                            </ol>
                            <div class="alert alert-info small">
                                <strong>Note:</strong> Must use Safari browser on iOS. Chrome/Firefox on iOS don't support PWA installation.
                            </div>
                        </div>

                        <!-- Benefits -->
                        <div class="alert alert-success">
                            <h6 class="mb-2">Benefits of Installing:</h6>
                            <ul class="mb-0 small">
                                <li>Works offline (after first load)</li>
                                <li>Faster loading times</li>
                                <li>No browser address bar (more screen space)</li>
                                <li>Appears like a native app</li>
                                <li>Easy access from home screen or taskbar</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" @onclick="Close">Got It!</button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public bool IsVisible { get; set; }
    
    [Parameter]
    public EventCallback OnClose { get; set; }
    
    private string activeTab = "howto";

    private async Task Close()
    {
        activeTab = "howto"; // Reset to first tab
        await OnClose.InvokeAsync();
    }
}
